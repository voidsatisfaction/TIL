# 25. 네트워크 기반 프로그램 활용

- 의문
- 네트워크 기반 프로그램 활용
  - ping
  - traceroute
  - netstat
  - route
  - tcpdump
  - ifconfig
  - 윈도우 ipconfig 유틸리티

## 25.1 네트워크 기반 프로그램 활용

### ping(연결테스트)

- 용도
  - **원격 호스트가 정상적으로 운영되고 있는지 확인하는 진단**
  - **전송 속도 확인**
  - 접속 대상 시스템의 IP 주소를 파악
- 특징
  - ICMP를 이용하는 유틸리티
    - Echo Request타입을 지정하여 대상 시스템으로 ICMP 패킷을 전송하고, 그 대상시스템으로 부터 echo reply 패킷을 수신함으로써, reachability를 확인
  - 해킹이나 간접 부하를 줄이기 위하여, ping 명령에 응답하지 않도록 설정하는 경우도 있음
- c.f) TTL(Time To Live)
  - 유닉스 계열은 255, 윈도우 계열은 128
  - 라우터를 지날 떄 마다 1씩 감소

### traceroute(경로추적)

- 용도
  - 종단 노드 사이에 있는 여러 중계 노드(L3장비 / 라우터) 각 구간에 대한 네트워크 상태를 관리하기 위한 명령어
    - 라우팅의 문제점을 파악하기 위해 사용
    - 중계 노드 개수, IP 주소, 응답시간 등을 파악 가능
- 동작 원리
  - 패킷의 TTL을 하나씩 증가시켜 보냄
  - 1의 TTL을 갖는 패킷은 도착한 라우터에서 TTL이 감소하고, ICMP 메시지가 출발지로 보내짐
  - 2의 TTL을 갖는 UDP 패킷은 두번째 라우터에 도달하여 소멸
  - 목적지에 도달할 떄 까지 패킷을 보내는데, 이 패킷은 사용 불가능한 포트번호(33434)를 붙여서 감
  - Unreachable Port라는 ICMP 메시지를 받으면 trace가 목적지에 도달했음을 알 수 있음
    - 우연한 도달을 방지하기 위해서 정확히 3개의 UDP 패킷을 보냄
- 활용
  - traceroute의 결과에서 응답시간이 *로 표시되는 경우
    - 침입차단시스템 등의 접근통제리스트에 의해 traceroute의 UDP 패킷이 보안상의 이유로 차단
    - 실제 해당 구간에 문제가 발생한 경우
  - 송신한 탐색 패킷의 결과가 5초 이내에 도달하지 않으면 해당 TTL의 왕복 시간은 * 기호로 표시됨
    - *근데 그보다 더 높은 TTL에서는 어째서 더 빨리 반환되는것인지?*
    - 해당 TTL의 라우터가 ICMP 메시지를 반환하지 않았다는 것을 의미

### netstat(네트워크 인터페이스 진단)

- 용도
  - 네트워크 인터페이스(LAN카드)에 대한 성능 정보
  - 시스템의 라우팅 정보
  - 소켓 사용 정보 등 지정옵션에 따라서 네트워크 정보를 제공
- 옵션
  - 무옵션
    - 생성된 네트워크의 연결정보를 출력
  - `-r`
    - 라우팅 정보(테이블) 출력
  - `-i`
    - 네트워크 인터페이스에 대한 정보 출력
  - `-s`
    - 각 네트워크 프로토콜 IP, TCP, UDP, ICMP에 대한 통계 정보 출력
  - `-a`
    - 모든 소켓 정보 출력
  - `-n`
    - 네트워크 주소 숫자로 나타냄
- 필드 내용
  - Proto
    - 응용 프로그램을 연결하기 위하여 사용한 프로토콜의 종류
  - Recv-Q
    - 원격 응용 프로그램으로부터 수신하여 버퍼에 저장한 데이터의 크기
  - Send-Q
    - 원격 응용 프로그램으로 전송하기 위하여 송신 버퍼에 저장한 데이터 크기
  - Local address
    - 연결에 사용한 로컬 호스트의 IP주소와 응용 프로그램이 사용하는 포트
  - Foreign Address
    - 로컬 호스트와 연결된 원격 호스트의 IP 주소와 응용 프로그램의 포트

3-way handshake

![](./images/ch25/3-way-handshake1.jpg)

4-way handshake

![](./images/ch25/4-way-handshake1.png)

- State
  - 연결과 관련된 소켓 상태
  - 3-way handshake 연결
    - 종류
      - LISTEN
        - 서버 프로그램이 연결을 기다리는 경우
      - SYN-SENT
        - 클라이언트 프로그램이 원격호스트에 연결을 요청한 상태
      - SYN-RECV
        - 서버가 클라이언트 프로그램으로 부터 연결요청을 받아 클라이언트에 응답을 하였지만, 아직 클라이언트의 확인 메시지를 받지 않은 상태
      - ESTABLISHED
        - 클라이언트와 서버 프로그램이 서로 연결된 상태
  - 4-way handshake 종료
    - 종류
      - FIN-WAIT1
        - 한쪽 응용 프로그램이 연결 종료를 요청한 생태
      - CLOSE-WAIT
        - 연결 종료 메시지를 수신하고 그에 대한 확인 메시지를 보낸 상태
      - FIN-WAIT2
        - 원격 호스트의 종결 메시지를 기다리는 상태
      - LAST-ACK
        - 로컬에서도 회선 종결에 합의한 상태로, 이에 대한 확인 메시지가 수신되면 회선이 종료
      - **TIME-WAIT**
        - 연결은 종료되었지만 마지막 종료 확인 메시지를 재전송할 경우를 감안하여 당분간 소켓정보 유지
        - 2MSL(Maximum Segment Lifetime)동안 유지
      - CLOSED
        - 완전히 연결이 종료된 상태

### route(라우팅 테이블 설정)

- 개요
  - `route`명령을 사용하여 라우팅 테이블에 라우팅 경로 추가 or 삭제

### tcpdump(네트워크 패킷/로그 분석)

- 개요
  - 네트워크 인터페이스를 거치는 패킷의 내용을 출력해주는 프로그램
  - 스니핑 도구의 일종으로 자신의 컴퓨터로 들어오는 모든 패킷의 내용을 도청할 수 있으며, 공격자의 추적 및 공격 유형 분석을 위한 패킷 분석시에 활용가능
  - 윈도우용은 `windump`

### ifconfig(네트워크 인터페이스 설정)

- 용도
  - 네트워크 인터페이스의 설정정보를 알아보기
  - IP 주소 및 서브넷마스크 등의 설정을 변경할 때 사용
  - 네트워크 인터페이스 활성 비활성화

### 윈도우 ipconfig 유틸리티

- 개요
  - 윈도우의 경우 대부분은 윈도우 제어판에서 수정가능
  - 윈도우의 ipconfig는 ifconfig보다 훨씬 간소함

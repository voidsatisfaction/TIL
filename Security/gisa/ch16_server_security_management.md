# 16. 서버 보안 관리

- 의문
- 16.1 서버관리자의 업무
  - 보안 유지 관리
  - 서버관리자의 업무
- 16.2 로그 설정과 관리
  - 시스템 로그 분석
  - 윈도우의 로그 분석과 설정
  - 유닉스/리눅스의 로그 분석과 설정
- 16.3 공개 해킹도구에 대한 이해와 대응
- 16.4 서버보안용 S/W 설치 및 운영

## 의문

## 16.1 서버관리자의 업무

- 시스템 관리의 6가지 주제
  - 계정과 패스워드 관리
  - 권한 관리
  - 세션 관리
    - 활성화된 접속에 대한 관리
  - 접근 제어
    - 네트워크 관점
  - 자원 관리
  - 취약점 관리
  - 로그 관리

### 보안 유지 관리

- 개요
  - 시스템을 구축한 후에, 보안 유지 관리 해야함
- 해야할 보안 유지관리 프로세스
  - 로깅 정보를 감시 분석
  - 정기적으로 백업 수행
  - 정기적으로 시스템 보안을 테스트
- 로깅
  - 이미 발생한 나쁜 일을 알려주는 반작용적 제어
  - 시스템 파괴 혹은 고장 시에 무슨 일이 발생했는지를 빠르고 정확하게 찾게 도와주고, 교정과 복구 노력에 집중 가능하게 함

### 서버관리자의 업무

- 시스템관리자 계정으로 작업하기
  - 방법
    - root계정으로 로그인
    - `su(switch user)`명령으로 root로 계정 바꾸기
      - 보안적으로 더 안전함
- 사용자 계정 관리
  - 위치
    - `/etc/passwd`
      - 사용자 계정
    - `/etc/shadow`
      - 사용자 비밀번호(암호화 됨)
  - 계정 사용 제한
    - 원격 접근권한 제어
      - `/etc/passwd` 파일에서 `/bin/bash`와 같은 셸을 삭제
    - 계정 사용기간 설정
      - `/etc/shadow` 파일에서 사용기간 또는 만료일 설정
- 자원 관리
  - 프로세스 관리
    - `ps`, `kill`, `wait`, `su`
    - `wait`
      - 프로세스가 끝나기를 기다리는 명령어
    - `nice`
      - 프로세스의 우선순위를 변경할 수 있는 nice값을 설정하는 명령어
  - 메모리 관리
    - `free`
      - 시스템의 실제 메모리와 스왑 메모리에 대한 사용 현황을 확인할 수 있는 명령어
  - 메일, 디스크 등의 관리
    - 리눅스에서는 디스크 사용량을 사용자 및 그룹별로 설정하기 위해서 `quota`사용
    - 메일 용량 크기 제한은 메일 스풀 디렉터리에 별도 파티션을 주고 그 파티션에 쿼터를 설정
    - `du`
      - 디스크 파일 사용량을 재귀적으로 보여줌
- 네트워크 관리
  - `ifconfig`
    - NIC 상태를 보여줌
  - `netstat -an`
    - 현 시스템에서 사용되는 통신 서비스의 상태
  - `top`
    - 시스템 자원(CPU, memory)등의 사용 현황
  - `ps -elf(-aux)`
    - 현 시스템에서 수행 중인 프로그램과 데몬 상태를 보여줌
  - `who, w`
    - 로그인되어 있는 사용자 보여줌
  - `snoop`
    - 네트워크를 흐르는 패킷을 캡쳐하여 분석
  - `nslookup`
    - 도메인에 대한 IP정보 및 도메인 네임과 관련된 여러 검색이 가능
  - `hostname`
    - 현 시스템에 할당된 호스트 이름을 보여줌
  - `traceroute`
    - 특정 호스트까지의 네트워크 라우팅 경로 및 경유하는 IP를 보여줌
  - `inetd`
    - 네트워크 슈퍼데몬인 inetd를 실행

## 16.2 로그 설정과 관리

### 시스템 로그 분석

- 로그에 대한 이해
  - 윈도우
    - Event라는 중앙 집중화된 로그를 수집하여 저장
    - 공격자는 대신 한 로그만 삭제
      - 보안 수준 낮음
  - Unix
    - 로그를 여러 곳에 산발적으로 저장
    - 공격자가 로그를 모두 찾아 지우기가 쉽지 않음

### 윈도우의 로그 분석과 설정

- 해커에 대한 즉각적인 확인
  - 현재 로그인된 사용자를 확인하는것도 중요
  - `net session`
    - 자신의 시스템에 로그인한 IP / 로그인 계정 / 클라이언트 운영체제 / 세션의 수 / 로그인 후 경과한 시간 출력
  - `net session /delete`
    - 세션 끊기
  - `psloggedon`은 로컬로 로그인한 계정 정보도 함께 보여줌
    - `net`과 차이점이 무엇인지?
- 윈도우 시스템 이벤트 로그 종류
  - Application program log
  - Security log
    - 유효하거나 유효하지 않은 로그인 시도
    - 파일 생성, 열람, 삭제같은 리소스 사용에 관련된 이벤트 기록
  - System log
    - Windows 시스템 구성요소가 기록하는 이벤트
    - e.g)
      - 시스템 부팅시 드라이버가 로드되지 않는 경우와 같은 구성요소 오류를 이벤트에 기록
  - Directory service log
    - Windows Active Directory service에 발생하는 이벤트
  - File copy service log
    - Windows 파일 복제 서비스에서 발생하는 이벤트
  - DNS server log
    - Windows DNS 서비스에 발생하는 이벤트
- 감사 정책
  - 정의
    - **어떤 로그를 남길지를 정의한 규칙**
  - 종류
    - 개체 액세스 감사
      - 특정 파일이나 디렉터리, 레지스트리 키, 프린터 등과 같은 객체에 접근을 시도하거나 속성 변경 등을 탐지
    - 계정 관리 감사
      - 신규 사용자, 그룹의 추가, 기존 사용자 그룹의 변경, 사용자의 활성화나 비활성화, 계정 패스워드 변경 등을 감사
    - 계정 로그인 이벤트 감사
      - 도메인 계정의 사용으로 인한 이벤트 감사
        - *도메인 계정이 뭐지?*
    - 로그인 이벤트 감사
      - 로컬 계정 접근 시 생성되는 이벤트 감사
    - 권한 사용 감사
      - 권한 설정 변경이나, 관리저 권한이 필요한 작업을 수행할 때 로깅
    - 디렉터리 서비스 엑세스 감사
    - 정책 변경 감사
      - 사용자 권한 할당 정책, 감사 정책 또는 신뢰 정책의 변경과 관련된 사항을 로깅
    - 프로세스 추적 감사
      - 사용자 또는 응용프로그램이 프로세스를 시작하거나 중지할 때 해당 이벤트 발생
    - 시스템 이벤트 감사
      - 시스템의 시동과 종료, 보안 로그 삭제 등 시스템의 주요한 사항에 대한 이벤트를 남김
- 로그 정책 설정
  - 제어판 - 관리도구 - 로컬 보안 정책 메뉴에서 로컬 정책 - 감사 정책에서 확인할 수 있음
  - 윈도우의 경우, 유닉스에 비해 로깅하는데 자원이 많이 소모됨
- 이벤트 로그 파일
  - `%Windows%¥system32¥config`폴더 아래에 있는 `.evt` 확장자를 가진 파일이며, 파일명은 이벤트 뷰어에서 보이는 로그파일명과 비슷함
  - 예시
    - Application program log
      - `AppEvent.Evt`
    - Security log
      - `SecEvent.Evt`
    - System log
      - `SysEvent.Evt`
  - 특징
    - 바이너리 형식이므로, 그냥 봐서는 모르고, 이벤트 뷰어 프로그램 등으로 열어서 봐야 함
    - 제어판 - 관리도구 - 이벤트 뷰어

### 유닉스/리눅스의 로그 분석과 설정

- 로그 디렉터리
  - `syslogd`
    - 중앙 집중적으로 로그를 관리하는 데몬
    - 이곳 이외에 다양한 장소에 로그 저장
- utmp(x) 로그
  - 정의
    - 현재 시스템에 로그인한 사용자의 상태를 출력
  - 로그 남기는 프로그램
    - `/etc/lib/utmpd`
  - 특징
    - 데이터는 `utmp.h`에서 정의된 구조체로 바이너리 형태로 저장
    - 커맨드로 확인 가능
      - `w`, `who`, `users`, `whodo`, `finger`등이 있음
- wtmp(x) 파일
  - 정의
    - 사용자의 로그인, 로그아웃, 시스템 재부팅 정보 담음
  - 로그 남기는 프로그램
    - `wtmpd`
  - 특징
    - `/usr/include/utmp.h` 파일의 구조체를 그대로 사용해서 바이너리 형태로 저장
    - 커맨드로 확인 가능
      - `last`
        - 올바로 로그인 된경우에 로그가 남음
- **loginlog(Unix/SunOS), btmp(Linux)**
  - 다소 소름..?
    - ssh bruteforce attack 볼 수 있음
  - Linux
    - 정의
      - 실패한 모든 로그를 남김
    - 특징
      - `/var/log/btmp` 바이너리 파일
  - Unix(SunOS)
    - 정의
      - 5회 이상 실패 시 실패한 로그 남김
    - 특징
      - `/var/adm/loginlog` 텍스트 파일
- lastlog
  - 정의
    - 가장 최근에 성공한 로그인 기록을 담고 있는 로그 파일
  - 특징
    - `lastlog` or `finger` 명령 사용, 바이너리 파일
- sulog(Unix/SunOS)
  - 정의
    - `su`에 대한 로그
  - 특징
    - `su root`, `su -root`는 모두 관리자 계정 권한으로 변경했기 때문에 `su`로그에 남으며, `/var/adm/sulog` 파일에 텍스트 형식으로 남음
      - 텍스트 파일의 권한은 600으로 설정되어있음
- acct/pacct(process account) 로그
  - 정의
    - 시스템에 로그인한 모든 사용자가 수행한 프로그램에 대한 정보를 저장하는 로그
  - 특징
    - `/usr/adm/pacct`, binary, `acctcom` or `lastcomm`
    - 사용자가 로그인했다가 로그오프할 때까지 입력한 명령과 연결에 이용한 터미널의 종류와 시간 등을 저장
    - 해커 추적 목적이 아닌, 대형 시스템을 여러 사용자가 비용을 지불하는 형식으로 공유할 경우, 각 사용자에 대한 요금을 부과하기 위해 사용됨
      - pacct는 시스템 자원을 비교적 많이 소모하며, 기본적으로 동작하지 않음
- `.sh_history` or `.hash_history`
  - 정의
    - 실행한 명령에 대한 기록
  - 특징
    - `~/.bash_history`, text, `history`
      - 파일은 600 권한이지만, 공격자에게 많은 정보를 주므로 위험
- FTP 파일 전송 로그(xferlog)
  - 정의
    - FTP로그 파일로서 proftpd 또는 vsftpd 데몬들의 서비스 내역을 기록하는 파일
  - 특징
    - 공격자가 FTP 서비스를 이용해 시스템에서 어떤 파일을 복사했는지, 또 어떤 파일을 시스템에 복사해두었는지 찾아내야 할 때 유용
    - 파일을 전송한 날짜와 시간, 접근 시스템 IP, 전송한 파일을 확인할 수 있음
- HTTPD Log(Access_log, Error_log)
  - apache
    - `/usr/local/apache/logs`
  - nginx
    - ...
- `dmesg`
  - 정의
    - 리눅스가 부팅될 때 출력되는 모든 메시지를 기록.
  - 특징
    - 부팅 시의 에러나 조치사항을 살펴보기 위해서 실행
- messages
  - 정의
    - 시스템의 가장 기본적인 시스템 로그파일
    - 시스템 운영에 대한 전반적인 메시지 저장
      - 시스템 데몬들의 실행상황과 내역
      - 사용자들의 접속정보
      - TCP Wrapper 접근 제어 정보
- secure
  - 정의
    - 사용자의 원격접속, 원격 로그인 정보를 기록하고 있는 로그파일
  - 특징
    - `/var/log/auth.log`, text
    - tcp_wrapper(xinetd)의 접속제어에 관한 로그파일은 언제, 누가, 어디에서 어떻게 접속했는가에 대한 로그 기록

## 16.3 공개 해킹도구에 대한 이해와 대응

## 16.4 서버보안용 S/W 설치 및 운영

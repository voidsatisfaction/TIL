# 14. 윈도우 서버 보안

- 의문
- 14.1 윈도우 개요
- 14.2 윈도우 보안
- 14.3 윈도우 서버 보안 설정
- 14.4 윈도우즈 네트워크 서비스

## 의문

## 14.1 윈도우 개요

### 윈도우 시스템의 구조

![](./images/ch14/windows_system_structure1.png)

- 개요
  - 5개의 링으로 구분
    - Kernel Mode
      - 하드웨어
      - *HAL(Hardware Abstraction Layer)*
        - 드라이버 개발자와 하드웨어 개발자가 따라야 하는 기본 표준
      - *마이크로 커널*
      - *각종 관리자*
    - User Mode
      - 응용 프로그램
  - 참고
    - 윈도우를 사용할 때, 사용자 모드에 문제가 생기면, OS는 해당 응용프로그램 종료하여 문제를 해결
    - 커널에 문제가 생기는 경우, 메모리의 정보를 덤프하고 시스템 재시작함

### 윈도우의 특징

|구분|설명|
|--|-----|
|GUI 환경|아이콘이라는 그림 명령을 통하여 쉽게 프로그램에 접근 가능|
|Plug & Play|하드웨어를 새롭게 추가하는 경우, 자동으로 인식하여 환경에 설정해 주는 기능(하드웨어가 Plug & Play를 지원하는 장치여야 함)|
|Short cut 아이콘(바로가기)|프로그램이나 데이터를 빠르고 편리하게 실행시키기 위해서 원하는 위치에 원본 파일을 연결한 아이콘 얻을 수 있음|
|멀티태스킹|한 번에 여러가지 작업 동시 수행|
|OLE(Object Linking Embedding)|프로그램 간에 개체(그림, 표 등) 교환 가능|
|네트워크 기능 향상|다양한 프로토콜을 제공하기 때문에 네트워크 설치나 인터넷 연결 등을 편리하게 할 수 있으며, *netbios* 프로토콜을 사용하여 네트워크 공유가 편리|
|다중 모니터 지원|한 대의 컴퓨터에 최대 8개의 모니터 연결 가능|
|정보의 전송 통합|두 개 또는 그 이상의 응용 프로그램에서 작업하여 상호간의 정보를 한 응용프로그램에서 다른 응용프로그램으로 전송 통합 가능(clipboard)|

### 윈도우 파일 시스템

- FAT16
  - 특징
    - 2^16개의 클러스터를 가질 수 있음
      - *1클러스터 32KB(근데 이게 volume에 따라서 유동적인 값?)*
      - 2GB(2^16 * 32 * 1024 = 2 * 1024 * 1024 * 1024)까지 한 파티션으로 사용 가능(즉, 최대 2GB까지 지원)
    - 너무 적음
- FAT32
  - 특징
    - 2^32개의 클러스터를 가질 수 있음
      - 1클러스터 4KB
    - 한 파일은 최대 4GB까지
    - 접근 제어 사용 불가
    - 현재도 종종 사용됨
- NTFS(NT File System)
  - 특징
    - *HotFixing기능*
      - 결함 관리, 보안에 훌륭
    - 접근 제어 가능
      - 암호화
      - 특정 계정의 사람이 언제 파일을 열거나, 열려다 실패했는지 Audit 기능 제공
  - 디스크 구조
    - MBR(Master Boot Record)
      - 정의
        - 물리적 디스크의 첫 번째 섹터에 위치하는 512B 크기의 영역
      - 구성
        - Boot code
        - Partition table
        - Signature
      - 운영체제가 부팅될 때, BIOS에 의해 POST(Power On Self Test)를 마친 후, MBR의 부트 코드를 호출하고, 부트 코드는 부팅 기능 파티션을 찾아 해당 파티션 VBR의 부트 코드를 호출하여 운영체제가 기동
    - VBR(Volume Boot Record)
      - 정의
        - 윈도우 부팅을 위한 기계어 코드와 볼륨 및 클러스터의 크기, MFT의 시작주소 등 설정 정보를 담고 있으며, 파티션의 가장 마지막 섹터에 VBR 백업본 존재
    - MFT(Master File Table)
      - 정의
        - 볼륨/파일시스템에 존재하는 모든 파일과 디렉터리에 대한 정보를 담고 있는 테이블
      - 구성
        - MFT 엔트리의 집합
        - 엔트리
          - 하나의 파일 또는 디렉터리에 대한 정보를 담고 있는 자료구조
          - 파일 위치, 시간, 크기, 이름 등 다양한 속성들로 구성
    - System File Area
      - MFT를 비롯해 파일 복사나 삭제 과정 중 시스템이 오류를 일으킬 때, 이를 복구하는 데 사용할 디스크 사용에 대한 로그 파일, 디스크 볼륨 이름 등 디스크 자체에 대한 정보를 담는 파일
    - File Area
      - 각 파일에 대한 실제 데이터가 저장
- 디스크 파괴형 악성 코드의 특징
  - 개요
    - MBR또는 VBR 영역을 훼손하여 컴퓨터가 정상적으로 부팅되지 않도록 하는 악성코드
  - 예시
    - MBR영역의 모든 값을 특정 문자나 랜덤한 더미 값을 덮어씌워 운영체제 부팅을 할 수 없도록 하거나, VBR영역을 훼손하여 파일 시스템 복구가 불가능하게 만듬
  - MBR 영역 훼손 복구
    - 부트 코드를 정상적인 디스크에서 복사하고, 각각의 파티션 정보를 수집하여 파티션 테이블을 완성함으로써 복구 가능
  - VBR 영역 훼손 복구
    - 파티션의 가장 마지막 섹터에 있는 VBR 백업본을 덮어써서 복구 가능
      - *공격자가 VBR 백업본 마저 공격한다면?*

|구분|FAT|NTFS|
|--|----|----|
|정점|- 호환성 우수 - 단순성 - 저용량 볼륨의 최적화|- 대용량 볼륨 지원 - 디스크의 효율적 사용 - 강력한 보안 기능 - 자동 압축 및 안전성 - 향상된 파일이름 저장 및 파일길이 지원|
|단점|- 보안 취약 - 대용량 볼륨의 비효율적|- Windows NT계열 운영체제 외에는 호환 불가 - 저용량 볼륨에서 FAT보다 속도 저하|

### 윈도우 부팅 순서

- 윈도우 XP, 윈도우 서버 2000/2003 부팅 순서
  - POST(Power On Self Test) 실행
    - 하드웨어 스스로 시스템에 문제가 없는지 기본 사항 검사
      - power supply, RAM, system bus 등등..
  - BIOS가 CMOS(Complementary Metal-Oxide Semiconductor)에 설정되어 있는 시스템 설정사항 및 부팅과 관련된 여러 가지 정보 읽어 시스템 적용
  - MBR(Master Boot Record) 로드
    - 부팅 매체에 대한 기본 파일 시스템 정보 로드
  - NTLDR(NT Loader) 실행
    - 부팅 파티션에 있는 프로그램으로, 부팅을 위한 간단한 파일 시스템 실행
    - `boot.ini` 파일 내용을 읽어 가능한 부팅 옵션 보여줌
  - NTDETECT.com 실행
    - NTLDR에서 제어권을 위임 받아 시스템에 설치
    - 하드웨어 검사
      - CPU유형, 버스 유형, 비디오 보드 유형, 키보드 마우스 종류, 컴퓨터에 장착되어있는 직렬 포트 병렬 포트, 플로피 드라이브 등
  - ntoskrnl.exe(NT OS Kernel) 실행
    - ntoskrnl은 `HAL.DLL`을 로드
- 윈도우 비스타, 2008, 7의 부팅 순서
  - POST(Power On Self Test) 실행
  - BIOS가 CMOS(Complementary Metal-Oxide Semiconductor)에 설정되어 있는 시스템 설정사항 및 부팅과 관련된 여러 가지 정보 읽어 시스템 적용
  - MBR(Master Boot Record) 로드
  - Windows Boot Manager 실행
    - bootmgr.exe가 실행되고, 부트 설정 데이터를 읽어 실행 가능한 운영체제의 목록 보여줌
  - 윈도우 OS 로더(Winload.exe) 실행
    - NTDETECT와 같이 각종 장치 드라이브 로드하고, ntoskrnl.exe 실행

## 14.2 윈도우 보안

### 윈도우 설치

- 윈도우 설치 시 주의사항
  - 파티션 나누기
    - 파티션
      - 하나의 물리적인 하드디스크에 논리적으로 분할 영역을 만드는 것
      - 하나의 하드디스크를 서로 별개의 하드디스크 처럼 쓰기 위해서 분할하는 것
    - 특징
      - 파티션을 나누면 서로 다른 드라이브로 인식
        - C드라이브에 심각한 오류가 발생해도 D드라이브에 있는 파일들은 안전하게 보존 가능
        - 윈도우를 2개이상 설치해서 사용하는 멀티부팅 가능

### 윈도우 계정, 권한, 인증

- 윈도우의 계정과 권한 체계
  - 기본 사용자와 그룹
    - 사용자
      - SYSTEM
        - 최고 권한을 가진 계정
        - 원격 접속 불가능
        - 사용자 로그인 불가능
      - Administrator
        - 사용자가 사용 가능한 계정 중 가장 강력한 권한을 가짐
      - Guest
        - 매우 제한적인 권한을 가진 계정
        - 기본 설정은 사용 불능
    - 그룹
      - Administrators
      - Account Operators
      - Backup Operators
      - Guests
      - Print Operators
      - Power Users
      - Replicator
      - Server Operators
        - 도메인 서버를 관리할 수 있는 권한을 가진 그룹
        - 로컬 로그인과 시스템 재시작 및 종료 권한 존재
      - Users
        - 도메인과 로컬 컴퓨터를 일반적으로 사용하는 그룹
        - 개개인에 할당된 사용자 환경을 직접 만들 수 있으나, 설정할 수 있는 항목에는 한계가 존재
          - 시스템 서비스 시작 및 종료 권한 없음
          - 디렉터리 공유 설정 불가
  - SID(Security Identifier)
    - 정의
      - 윈도우의 각 사용자나 그룹에 부여되는 고유한 식별번호
    - 확인
      - `whoami /user` 명령
    - 구조
      - `S-1-5-21-1801674531-839522115-1708537768-500`
        - S
          - SID
        - 1
          - revision number(SID 명세의 버전)
        - 5
          - Identifier authority value(48bits, 윈도우 보안 권한)
        - 21-1801674531-839522115-1708537768
          - Sub-authority value
          - 시스템의 고유한 숫자로, 시스템을 설치할 때, 시스템의 특성을 수집하여 생성
        - 500
          - relative ID
          - 기본적으로 생성되는 builtin 계정이 아니라면 1000보다 큰 숫자의 RID 생성
          - Administrator: 500
          - Guest: 501
          - 일반 사용자: 1000 이상 숫자
- 윈도우의 권한 상승
  - 정의
    - 일반 권한의 사용자가 Administrator와 SYSTEM으로 실행되고 있는 프로세스의 권한을 빼앗는 것
- 윈도우 인증과 패스워드

### 공유자료 관리

- 네트워크 드라이브의 이해
- 파일과 폴더의 보안권한 설정
- 디렉터리 및 파일에 대한 접근 권한 설정
- 공유 자료 관리

### 암호 기능 사용

- EFS(Encrypting File System) 폴더 및 파일 암호화
- BitLocker(볼륨 암호화)

### 레지스트리 활용

- 레지스트리 개요
- 레지스트리 편집기 실행
- 레지스트리 보호
- 레지스트리 공격

### 윈도우 방화벽(PC 방화벽) 설정

- 개요
- 설정 방법

## 14.3 윈도우 서버 보안 설정

### 계정 관리

- Administrator 계정 이름 바꾸기
- Guest 계정 상태
- 계정 잠금 임계값과 잠금 기간 설정
- 관리자 그룹에 최소한의 사용자 포함
- 암호와 패스워드 정책 설정

### 서비스 관리

- 공유 권한 및 사용자 그룹 설정
- 하드디스크 기본 공유 제거
- 불필요한 서비스 제거
- Anonymous FTP 금지

### 패치 관리

- 감사 정책에 따른 시스템 정책 설정

### 보안 관리

- SAN 파일 접근 통제 설정
- 화면보호기설정

## 14.4 윈도우즈 네트워크 서비스

### 디렉터리 데이터베이스(Directory Database)

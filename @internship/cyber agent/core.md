# サイバーエージェントから学んだことのコア

期間：2017.10.19 ~ 2017.11.15
担当：サーバーサイドエンジニア

Goを初めて書いて見ました！

## 精神・姿勢

### 責任

会社の一員としても責任意識は大事である。会社の一員である以上、会社のルールに従わなければならない。そして、自分の書いたコードに関してきちんとテストを書くなどの責任を持つ必要がある。

### 情報資源の保護

初日のガイダンスとオンライン教育システムで勉強することができた。サイバーは非常に情報資産を大切にしている気がした。確かに、もっとも基本的でもっとも忘れがちのところでもある。

### 質問する前には、きちんと自分の考えをまとめてから相手に聞きに行く

普段から私が心がけている「学習」に対する信念である。

内容としては、もちろん自分がわからないから聞きに行くことであろうが、ある程度自分がきちんと考え、言語化（紙に書くとか）してから聞くことが勉強になるし、相手が教えやすくする。

もちろん、他人の考え方と比較できるところで非常に良い勉強にもなる。

## 技術

### タイピングシステム

いつも、タイプがあることが正しいわけではない。ユーザーに近ければ近いほど、タイプがあること自体がよくなくなる可能性がある。例えば、フロントエンドでは時間のデータをユーザーに見せる時に、ユーザーが見やすい形で見せないといけない。しかし、そこでタイプがあると、そこの操作がややこしくなる。

上の話からわかることは、「タイプシステムの効用」が薄くなる時点が必ず存在するとのことである。いつも正しいというものはない。

### サーバサイド

MVCモデルに沿って実装されている。MとCの間にServiceという層を挟んで、責務を分担している。そして、ロジックの再利用を促進する。

- [서버리스 아키텍쳐](http://blog.aliencube.org/ko/2016/06/23/serverless-architectures/)

### JSON Schema

サーバーサイドのAPIレスポンステストに適用できるJSON Schema。これをまとめると、htmlページで人が見やすい形に形成することができる。なお、テストを実行するときに、定義したSchemaとresponseが同じ形になっているのかをチェックし、そうでなければエラーを出してくれるので、非常にありがたい。

- [JSON-Schema 韓国語翻訳](https://github.com/mcchae/JSON-Schema/blob/master/JSON-Schema.md)

### テスト

非常に大規模で様々な機能が入っていたので、やはりテストが非常に充実している。APIテストとUnitテストに別れて実装されている。

- [GoのTestに対する考え方](https://qiita.com/Jxck_/items/8717a5982547cfa54ebc)

### GO言語

楽しい！そして、キャラクターが可愛い！

#### Go Blog

本当に役に立つ情報がいっぱい！

- [Go Blog](https://blog.golang.org/index)

#### Go routineと Channel

Apiを並行的に実行したり、一つのApiを複数送るときにSequential的な考えが必要なかったら、`go routine`と `channel`を利用しよう！

それだけではなくて、Async的な処理が必要なときには、go routineを積極的に使おう。

- [Goルーチンで並行化する方法: 6秒かかる処理を3秒にしよう](https://qiita.com/suin/items/82ecb6f63ff4104d4f5d)

#### Go http

Goのhttpのpackageを詳しく見て見た。`http RoundTripper`というものを使って、httpリクェストに対するモックデータを生成できる。

TCP/IPのところのような中のロジックを勉強しておきたい。

- [godoc http](https://golang.org/pkg/net/http/#Transport.RoundTrip)

#### Go exec

Go言語はなんと、コマンドを実行することができ、その結果を文字列などで送ってもらうことが可能である。今回は、テストで作られたダミー画像データを`Go exec`を使って削除した。非常に便利である。

#### Go image

- [godoc image](https://golang.org/pkg/image/#Image)
- [golang image package blog](https://blog.golang.org/go-image-package)

Go言語は、イメージデータも内蔵packageを通じて扱うことができる。今回の場合、exifファイルのorientationを補正するために使った。

#### Go interface

もともと、空のインターフェースの意味がよくわからなかったが、サーバーの中身の実装や- **[Goのinterface設計](http://jxck.hatenablog.com/entry/20130325/1364251563)** を参考に少しはわかるようになった。

#### Go Proverbs

[go-proverbs-io](https://go-proverbs.github.io/)

#### Gooseを利用したDBもマイグレーション管理

Gooseを使ってDBのマイグレーションを管理する。

#### Go オススメ

- [Go empty struct](https://dave.cheney.net/2014/03/25/the-empty-struct)
- [Goのinterface設計](http://jxck.hatenablog.com/entry/20130325/1364251563)
- [GopherCon 2014](https://github.com/gophercon/2014-talks)

### Database

ようやく完成したAPIが速度が遅すぎて実際には使えない。中身を見ると、確かにqueryを200も叩いてるが、それは無駄。

このボトルネックを解消しようとしたら

1. Go routineとchannelを利用：サーバの負担増加
2. SQL文のtuningでquery文を減らす

方法などがある。

なんだか、競技プログラミング的なもので非常に面白かった。家に帰ってあとで詳しく勉強してみよう。

[MySQL Cookbook](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.163.4839&rep=rep1&type=pdf)

### Shell Script

「Unixという考え方」という本から書いてあるように、ソフトウェアのてこをうまく使用することの一環がShell Scriptを使いこなすことである。

サーバーサイドの仕事をするときに、しばしば使う機会がある。とても、便利である。

### Dotfile

いつも、他の会社にインターンをしにいくと、会社のMacに環境設定を一からやらないといけない問題があった。そこで、Dotfileを使って一気で自分の好きなセッティングにしておくと非常に良いと思う。

このファイルがきちんとセッティングされているかどうかは、Docker内で確認してみる。

### Infra

ウェブサビスのアーキテクチャ

### DevOps(最新ツール)

- Jenkins
- CircleCI
- Slack bot(通知用)
- Jira
- Confluence
- Vagrant
- Ansible
- Docker
- Elastic Search
- Mackerel
- Sensu/Uciwa
- Prott(design)
- Invision(design)

### これってどうすればいいの？

1. サーバーのテストを書くときに、サーバが他のサーバーのAPIを利用していて、そこのモックを`新しいサーバーではない`形で作る方法はあるだろうか。もともとは`http roundTripper`を使ったものにしようとしたが、それだと、テスト内のすべてのhttp requestがlistenされてしまう。モックサーバを使わずに（つまり、管理コストを減らして）外部APIを利用したテストをするにはどうすればようだろうか？
2. あるものの人気順を外からデータをもらってそのデータのサブデータをもらってサブデータの最新順でソートしてclientに返すものの実装。ここの最適化？(go routine? aurora?)

## デザイン

### Q デザインのセンスは生まれつきのセンスなのか？

誰でも勉強すればできる。大事なのは、芸術を行なっているわけではないので人のものをよく見てそのノーハウを記録すること。

## 余談

### Ameba vs Abema?

サイバーで働く前は、CAでは、全てのサービスをAmebaと称すると思った。しかし、AmebaTVではなくて、AbemaTVらしい。

## 社外活動

1. 最近Goを始めました会参加
2. AbemaTV Conference参加

非常に有益なConferenceであった。詳しい内容は、Conferenceを参照。

## もらったfeedback

良い
- 積極的に質問して、持ち帰ろうとする姿勢がすごくよかった。
- 飲み込みが早い。
- きちんとテストやドキュメンタリーまで書く。
- システム設計にも興味を持っている。
- コミット履歴がきれい
- コードを読み解く力がある。
- もともと競技プログラミングやっていたので、ロジックの正しいコードをかける

どうかな
- もともと、フロントしかやらなかったのでServer、DB、Middleware、Infraに対する知識が足りない。

これから
- 様々な技術を試して見てね。学生の時代はどんどん失敗して、それを成長に繋げましょう。

## 感想

サイバーエージェントの前までのインターンシップは短期間でものを作るハッカソン型や実際サービスとは関係はないものの開発などが多かった。

しかし、サイバーエージェントでは、インターン生でありながらもきちんと50万人のユーザーがあるサービスの開発一員となって、なお正社員と同じレベルの開発をすることができて、大規模サービスの裏面をわかるなど非常に楽しかった。このような貴重な機会をくださったサイバーのみなさんに感謝感謝。

特に一ヶ月間色々質問しまくっても、丁寧に説明してくださったメンターのOliverさんに非常に感謝する。

なお、サーバーサイドは初めてだったので2~3段階はアップされたと思う。そして、何よりもサーバーサイドエンジニアの楽しさを感じることができたので、これからもフロントサーバー関係なくどっちも頑張っていきたい（当分はサーバーサイドを頑張りたい笑）

# 인증

보안의 기본 목표는 피해를 최소화 시키는 것이다.
그리고 옆집보다 안전한 철창을 만드는 것이 중요한 것이다(앱의 가치 vs 해킹에 필요한 코스트)

## Id / Password 제시

가장 원시적인 인증 방식은 Client가 Server에 권한이 필요한 행위를 할 경우에
Id와 Password를 제시해 주는 방식.

너무 리스크가 큼.

## Session

그 다음 인증 방식은 첫 로그인때 Server가 DB와 계정정보를 대조하여
일치하는 계정이 있으면 그 클라이언트와 서버를 Session을 이용하여 연결시키는 방식.
한번 연결되면 유저는 유저정보를 보내는 것으로 인증을 간략화 할 수 있다.

서버가 유저 정보를 가지고 있음(메모리, DB)

세션은 별도의 통신 규약이 있음.

결국 서버가 클라이언트의 state를 갖고 있는것이므로 Restful과는 거리가 있다.

그리고 서버의 Scaleability가 불가능함(세션 연결이 끊어지므로..)

## Token

토큰 방식은 유저가 ID PW를 Server에 보내면
Server가 계정정보를 갖고 있는 DB1에 ID PW를 대조하여 존재한다면 DB1이 UserInfo데이터를 서버에 주고
서버는 UserInfo를 Token을 생성할 수 있는 DB2에 저장하고 토큰을 받아서 User에게 건네준다.

이렇게 해두면 유저는 요청에 Token을 같이 보내는 것으로 Server가 DB2와 요청받은 토큰 값과 바교를할 수 있게 되어서
Stateless서버를 실현 가능하게 한다(서버는 오직 Token만 가지고 있다)

토큰 인증의 방식
1. 난수
2. 부호화 / 복호화

## Token Management

토큰 관리에서 가장 중요한 것은 토큰을 갱신하는 **주기**이다.

토큰 관리 방식
1. 일회용 토큰
2. 일반토큰 / 리프레시토큰
3. 제삼자 이용(firebase)

유저가 Firebase에 아이디 비밀번호를 보낸다.
Firebase가 토큰을 보내준다
유저가 그 토큰을 서버에 보낸다.
서버는 Firebase에 그 토큰의 존재여부를 묻는다.
Firebase는 그것에 그렇다고 하면서 uid를 서버에 넘겨준다.
서버는 받은 uid와 userInfo와 customInfo등을 DB에 넘겨준다.
DB는 토큰을 생성하여 서버에게 준다.
서버는 받은 토큰을 user에게 넘겨준다.

주의

uid는 불변의 데이터

# 참조
- 사부
- [토큰기반 인증에 대한 소개](https://velopert.com/2350)